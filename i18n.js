const translations = {
    es: {
        // ... (traducciones existentes de login, register, app, home, etc.)
        loginTitle: "Accede a Template Suite",
        loginSubtitle: "Inicia sesión para generar plantillas para email y whatsapp en segundos.",
        emailPlaceholder: "Tu Correo Electrónico",
        passwordPlaceholder: "Tu Contraseña",
        forgotPassword: "¿Olvidaste tu contraseña?",
        loginButton: "Iniciar Sesión",
        noAccount: "¿No tienes una cuenta?",
        registerNow: "Regístrate ahora",
        registerTitle: "Crea tu cuenta en Template Suite",
        registerSubtitle: "Comienza a usar la herramienta para generar plantillas para email y whatsapp en segundos.",
        namePlaceholder: "Nombre",
        lastnamePlaceholder: "Apellido",
        languagePlaceholder: "Idioma",
        createAccountButton: "Crear Cuenta",
        alreadyAccount: "¿Ya tienes una cuenta?",
        loginHere: "Inicia sesión aquí",
        sidebarHome: "Inicio",
        sidebarMailCraft: "MailCraft",
        sidebarWhatsCraft: "WhatsCraft",
        sidebarTemplates: "Plantillas",
        userMenuSettings: "Ajustes",
        userMenuLogout: "Cerrar Sesión",
        mobileHeaderTitle: "Inicio",
        homeTitle: "Bienvenido a Template Suite",
        homeSubtitle: "Tu centro de herramientas para una comunicación más eficiente. Elige una herramienta para comenzar.",
        mcCardDescription: "Crea correos personalizados de alto impacto en segundos. Usa plantillas dinámicas y procesa listas de contactos para agilizar tu comunicación.",
        goToMailCraft: "Ir a MailCraft",
        wcCardDescription: "Genera links de WhatsApp y mensajes personalizados al instante. Ideal para contactar leads de forma rápida y eficiente, manual o masivamente.",
        goToWhatsCraft: "Ir a WhatsCraft",
        mcTitle: "Crea correos personalizados de alto impacto en segundos.",
        wcTitle: "Genera links de WhatsApp y mensajes personalizados al instante.",
        step1: "1. Elige tu Plantilla",
        step1WC: "1. Elige tu Plantilla de Mensaje",
        step2: "2. Proporciona los Datos",
        step3: "3. Resultado Final",
        manualInput: "Entrada Manual",
        processFile: "Procesar Archivo",
        clickToUpload: "Haz clic para subir",
        orDrag: " o arrastra",
        downloadExample: "Descargar plantilla de ejemplo",
        generateEmail: "Generar Correo",
        generateLink: "Generar Link",
        leadEmail: "Email del Lead",
        copy: "Copiar",
        subject: "Asunto",
        emailBody: "Cuerpo del Correo",
        generating: "Analizando y generando...",
        sendEmail: "Enviar Correo",
        myTemplates: "Mis Plantillas",
        clickTags: "Haz clic en los tags para insertarlos en tu plantilla.",
        clickTagsWC: "Haz clic en el tag para insertarlo. ¡Puedes usar emojis! 😉",
        createNewTemplate: "Crear Nueva Plantilla",
        whatsappLink: "Link de WhatsApp",
        goTo: "Ir a...",
        whatsappMessage: "Mensaje para WhatsApp",
        copyMessage: "Copiar Mensaje",
        sendWhatsapp: "Enviar WhatsApp",
        templatesTitle: "Gestor de Plantillas",
        templatesSubtitle: "Busca, edita y elimina todas tus plantillas en un solo lugar.",
        emailTemplates: "Plantillas de Email",
        whatsappTemplates: "Plantillas de WhatsApp",
        settingsTitle: "Ajustes",
        settingsSubtitle: "Gestiona la información de tu perfil y tus preferencias.",
        profileInfo: "Información del Perfil",
        nameLabel: "Nombre",
        lastnameLabel: "Apellido",
        languageLabel: "Idioma de la Interfaz",
        saveProfile: "Guardar Perfil",
        updatePassword: "Actualizar Contraseña",
        newPassword: "Nueva Contraseña",
        updatePasswordBtn: "Actualizar Contraseña",

        // --- NUEVAS TRADUCCIONES ---
        noTemplates: "No tienes plantillas. ¡Crea una para empezar!",
        createTemplateFirst: "Crea una plantilla primero",
        templateNameLabel: "Nombre de la Plantilla",
        templateSubjectLabel: "Asunto de la Plantilla",
        templateBodyLabel: "Cuerpo de la Plantilla",
        saveChanges: "Guardar Cambios",
        writeHere: "Escribe aquí el contenido...",
        confirmDelete: "¿Estás seguro de que quieres eliminar la plantilla \"{templateName}\"?",
        templateSaved: "Plantilla guardada.",
        templateNameEmpty: "El nombre de la plantilla no puede estar vacío.",
        newTemplateName: "Nueva Plantilla",
        newTemplateSubject: "Asunto para {{nombre}}",
        fileErrorEmail: "El archivo debe contener al menos las columnas \"nombre\" y \"email\".",
        fileReadError: "Error al leer el archivo.",
        leadsFound: "{count} leads encontrados.",
        generateForLead: "Generar para Lead {current} de {total}",
        fileEmpty: "El archivo está vacío.",
        processFinished: "Proceso Finalizado",
        pasteContactInfo: "Pega la información del contacto.",
        noMoreLeads: "No hay más leads que procesar.",
        dataExtractionError: "No se pudieron extraer los datos.",
        copied: "¡Copiado!",
        copyError: "Error al copiar.",
        noEmailFound: "No se ha encontrado una dirección de correo."
    },
    en: {
        // ... (traducciones existentes)
        loginTitle: "Access Template Suite",
        loginSubtitle: "Log in to generate email and WhatsApp templates in seconds.",
        emailPlaceholder: "Your Email Address",
        passwordPlaceholder: "Your Password",
        forgotPassword: "Forgot your password?",
        loginButton: "Login",
        noAccount: "Don't have an account?",
        registerNow: "Register now",
        registerTitle: "Create your Template Suite Account",
        registerSubtitle: "Start using the tool to generate email and WhatsApp templates in seconds.",
        namePlaceholder: "First Name",
        lastnamePlaceholder: "Last Name",
        languagePlaceholder: "Language",
        createAccountButton: "Create Account",
        alreadyAccount: "Already have an account?",
        loginHere: "Login here",
        sidebarHome: "Home",
        sidebarMailCraft: "MailCraft",
        sidebarWhatsCraft: "WhatsCraft",
        sidebarTemplates: "Templates",
        userMenuSettings: "Settings",
        userMenuLogout: "Logout",
        mobileHeaderTitle: "Home",
        homeTitle: "Welcome to Template Suite",
        homeSubtitle: "Your tool hub for more efficient communication. Choose a tool to get started.",
        mcCardDescription: "Create high-impact personalized emails in seconds. Use dynamic templates and process contact lists to streamline your communication.",
        goToMailCraft: "Go to MailCraft",
        wcCardDescription: "Generate WhatsApp links and personalized messages instantly. Ideal for contacting leads quickly and efficiently, manually or in bulk.",
        goToWhatsCraft: "Go to WhatsCraft",
        mcTitle: "Create high-impact personalized emails in seconds.",
        wcTitle: "Generate WhatsApp links and personalized messages instantly.",
        step1: "1. Choose your Template",
        step1WC: "1. Choose your Message Template",
        step2: "2. Provide the Data",
        step3: "3. Final Result",
        manualInput: "Manual Input",
        processFile: "Process File",
        clickToUpload: "Click to upload",
        orDrag: " or drag and drop",
        downloadExample: "Download example template",
        generateEmail: "Generate Email",
        generateLink: "Generate Link",
        leadEmail: "Lead's Email",
        copy: "Copy",
        subject: "Subject",
        emailBody: "Email Body",
        generating: "Analyzing and generating...",
        sendEmail: "Send Email",
        myTemplates: "My Templates",
        clickTags: "Click on the tags to insert them into your template.",
        clickTagsWC: "Click on the tag to insert it. You can use emojis! 😉",
        createNewTemplate: "Create New Template",
        whatsappLink: "WhatsApp Link",
        goTo: "Go to...",
        whatsappMessage: "Message for WhatsApp",
        copyMessage: "Copy Message",
        sendWhatsapp: "Send WhatsApp",
        templatesTitle: "Template Manager",
        templatesSubtitle: "Search, edit, and delete all your templates in one place.",
        emailTemplates: "Email Templates",
        whatsappTemplates: "WhatsApp Templates",
        settingsTitle: "Settings",
        settingsSubtitle: "Manage your profile information and preferences.",
        profileInfo: "Profile Information",
        nameLabel: "First Name",
        lastnameLabel: "Last Name",
        languageLabel: "Interface Language",
        saveProfile: "Save Profile",
        updatePassword: "Update Password",
        newPassword: "New Password",
        updatePasswordBtn: "Update Password",
        
        // --- NEW TRANSLATIONS ---
        noTemplates: "You don't have any templates. Create one to get started!",
        createTemplateFirst: "Create a template first",
        templateNameLabel: "Template Name",
        templateSubjectLabel: "Template Subject",
        templateBodyLabel: "Template Body",
        saveChanges: "Save Changes",
        writeHere: "Write your content here...",
        confirmDelete: "Are you sure you want to delete the template \"{templateName}\"?",
        templateSaved: "Template saved.",
        templateNameEmpty: "Template name cannot be empty.",
        newTemplateName: "New Template",
        newTemplateSubject: "Subject for {{nombre}}",
        fileErrorEmail: "The file must contain at least the columns \"nombre\" and \"email\".",
        fileReadError: "Error reading the file.",
        leadsFound: "{count} leads found.",
        generateForLead: "Generate for Lead {current} of {total}",
        fileEmpty: "The file is empty.",
        processFinished: "Process Finished",
        pasteContactInfo: "Paste the contact information.",
        noMoreLeads: "No more leads to process.",
        dataExtractionError: "Could not extract data.",
        copied: "Copied!",
        copyError: "Error copying.",
        noEmailFound: "No email address found."
    }
};

class I18n {
    constructor() {
        this.lang = 'es';
        this.loadLanguage();
    }

    loadLanguage() {
        const savedLang = localStorage.getItem('templateSuiteLang');
        if (savedLang && translations[savedLang]) {
            this.lang = savedLang;
        }
    }

    setLanguage(lang) {
        if (translations[lang]) {
            this.lang = lang;
            localStorage.setItem('templateSuiteLang', lang);
            this.updateContent();
        }
    }

    updateContent() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.getString(key);

            if (translation) {
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    if (element.type !== 'submit' && element.type !== 'button') {
                       element.placeholder = translation;
                    } else {
                       element.value = translation;
                    }
                } else {
                    element.textContent = translation;
                }
            }
        });
        document.documentElement.lang = this.lang;
        document.querySelectorAll('.language-selector').forEach(selector => {
            selector.value = this.lang;
        });
    }
    
    getString(key) {
        return translations[this.lang]?.[key] || key;
    }
}

// Adjunta la instancia al objeto global App para que main.js pueda usarla.
window.App = window.App || {};
window.App.i18n = new I18n();

// IMPORTANTE: Ya no se necesita un listener de DOMContentLoaded aquí.
// main.js se encargará de llamar a updateContent() en el momento adecuado.